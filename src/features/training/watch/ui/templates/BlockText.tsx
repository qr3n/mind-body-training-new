'use client';

import { motion } from "framer-motion";
import { Button } from "@/shared/shadcn/ui/button";
import { IoArrowBack } from "react-icons/io5";
import { PropsWithChildren, ReactElement, useRef, useCallback } from "react";

interface IProps extends PropsWithChildren {
    text?: string,
    handleNext: () => void,
    handlePrev: () => void,
    icon?: ReactElement
}

export const BlockText = (props: IProps) => {
    const throttleTimerRef = useRef<number | null>(null);

    const throttle = useCallback((callback: () => void) => {
        if (throttleTimerRef.current === null) {
            callback();
            throttleTimerRef.current = window.setTimeout(() => {
                throttleTimerRef.current = null;
            }, 700);
        }
    }, []);

    const handleNext = useCallback(() => {
        throttle(props.handleNext);
    }, [props.handleNext, throttle]);

    const handlePrev = useCallback(() => {
        throttle(props.handlePrev);
    }, [props.handlePrev, throttle]);


    return (
        <div className='relative w-[100dvw] h-[100dvh] flex items-center justify-center'>
            <motion.div
                initial={{height: 0}}
                animate={{height: '50%'}}
                exit={{height: 0, transition: {delay: 0}}}
                transition={{delay: 0.1}}
                className='transform-gpu flex items-center justify-center w-full max-w-[1024px] bg-blue-500 rounded-b-[40dvh] top-0 left-1/2 -translate-x-1/2 absolute -z-50'
            >
                <motion.div
                    initial={{ transform: 'translateY(-100dvh)' }}
                    animate={{ transform: 'translateY(0)' }}
                    exit={{ transform: 'translateY(-100dvh)' }}
                    className='flex flex-col items-center justify-center'>
                    <motion.h1
                        initial={{scale: 0}}
                        animate={{scale: 1}}
                        exit={{scale: 0, transition: {delay: 0.1}}}
                        className='text-white w-full font-medium [font-size:_clamp(5px,4dvh,36px)] -mt-12 max-w-[300px] text-center'>
                        {props.text}
                    </motion.h1>
                    <motion.div
                        initial={{scale: 0}}
                        animate={{scale: 1}}
                        exit={{scale: 0, transition: {delay: 0.1}}}
                    >
                        {props.children}
                    </motion.div>
                </motion.div>
            </motion.div>

            <motion.div
                initial={{scale: 0}}
                animate={{scale: 1}}
                exit={{scale: 0, transition: {delay: 0.05}}}
                transition={{delay: 0.15}}
                className='
                    flex items-center justify-center w-max h-max
                transform-gpu
                shadow-2xl
                bg-[#f2f6fe]
                rounded-full
                border
                z-50
                p-2
                '
            >
                <div className='border-4 rounded-full border-blue-500  w-[270px] h-[270px] max-w-[30vh] max-h-[30vh] cursor-pointer flex items-center justify-center'>
                    {props.icon ||
                        <svg className='max-w-[23vh] max-h-[23vh] mt-5 ml-1.5   ' xmlns="http://www.w3.org/2000/svg" width="200" height="200"
                             viewBox="0 0 927 843" fill="none">
                            <path
                                d="M106.933 43.3333C104.133 44.5333 101.867 46.9333 100.533 50.1333C98.5333 54.8 98.6666 56.1333 102 64.2666C102.667 66 101.733 66.8 97.6 68.1333C93.0667 69.4666 91.7333 69.3333 89.2 67.4666C84.6666 64.4 80.4 64.8 71.0667 69.2C62.8 73.2 62.2666 73.8666 61.0666 81.8666C60.6666 84.5333 53.0666 88 52.4 85.8666C52.1333 85.2 50.8 82.6667 49.3333 80.2666C42.2666 68.6667 25.3333 73.2 25.3333 86.6667C25.3333 91.3333 30.8 106.667 34.6666 112.933C38.4 118.933 46.1333 120.267 52.9333 116C58 113.067 59.7333 106.4 57.4666 99.7333C55.8666 95.0667 56.4 93.8666 61.3333 92.8C66.5333 91.6 68.8 96.2666 75.4666 121.067C84.2667 153.6 86.1333 156.933 109.733 179.867L129.333 199.2V226.667V254.133L115.733 282.8L102.133 311.333L101.6 326.133C101.067 340.933 101.067 340.933 104.8 343.867C108 346.4 110 346.667 123.6 346.667C142.133 346.667 146.133 345.2 147.333 337.6C149.467 325.6 152.667 317.2 159.733 306.4C163.867 300 167.6 294.667 168 294.667C168.4 294.667 172.133 299.733 176.267 305.867C182.8 315.333 184.4 319.067 186.667 328.933C190.667 345.867 191.733 346.667 211.867 346.667C225.867 346.667 228 346.4 231.2 343.867C234.533 341.2 234.667 340.667 234.667 327.067V312.933L221.2 284.133C213.733 268.267 206.533 254.4 205.2 253.067C202 250.267 201.6 238.933 204.667 237.867C206.267 237.2 206.667 233.733 206.667 218.267V199.467L226.533 180C250 157.067 252.4 153.067 261.333 119.333C267.867 94.5333 270.8 89.2 276.933 91.4666C279.067 92.2666 280.533 93.6 280.267 94.8C277.467 106 278.533 111.2 284.4 114.667C289.467 117.867 293.467 118 298.533 115.333C301.467 113.867 303.467 110.667 307.2 101.867C313.6 86.4 313.867 84.9333 311.333 79.6C306.4 69.0667 291.867 69.4666 287.067 80.2666C285.867 83.0667 284.133 85.3333 283.467 85.3333C279.733 85.2 275.467 81.6 274.133 77.3333C273.067 73.7333 271.2 72 266.667 69.7333C257.333 65.2 252.267 64.5333 247.2 67.3333C243.333 69.3333 242.267 69.4666 238.667 68C235.333 66.6667 234.667 65.7333 235.333 63.4666C238.533 52.5333 235.867 45.4666 227.467 42.6666C223.333 41.3333 221.867 41.4666 217.733 43.6C213.333 45.7333 212.267 47.4666 207.733 58.5333C204.933 65.4666 202.667 72.5333 202.667 74.1333C202.667 81.4666 208.933 88 216 88C221.067 88 226.133 84.2666 228.533 78.8C230.933 73.4666 231.067 73.4666 235.2 75.2C238.533 76.5333 239.467 77.8666 240.133 82C240.8 86.2666 239.6 91.0667 233.733 108C229.733 119.333 224.933 130.667 223.067 133.067C221.333 135.467 215.867 140.4 211.067 144C203.067 150 201.6 150.667 195.2 150.667H188.133L190.133 146C191.067 143.467 192 139.6 192 137.333C192 134.267 192.667 133.333 194.533 133.333C197.733 133.333 200.533 130 199.467 127.333C199.067 126.267 197.467 125.333 196 125.333C193.467 125.333 193.333 124.533 193.333 110.933C193.333 99.2 192.933 95.8666 190.667 92.4C186.267 85.0667 182.4 84 161.333 84C143.2 84 142.4 84.1333 139.333 87.3333C136.4 90.1333 136 91.7333 136 101.2C136 110.533 136.4 112.267 139.333 115.733C143.467 120.667 143.733 125.333 140 125.333C138.533 125.333 136.933 126.267 136.533 127.333C135.467 130 138.267 133.333 141.467 133.333C143.333 133.333 144 134.267 144 136.933C144.133 139.067 144.933 142.933 145.867 145.6L147.733 150.667H140.667C134.133 150.667 133.067 150.133 123.6 142.667C112 133.6 111.867 133.333 105.2 115.333C100.133 101.733 97.4667 98 94.4 101.067C93.0667 102.4 93.7333 105.733 97.8667 118C100.667 126.4 104.4 135.067 106 137.333C107.6 139.467 113.467 144.933 119.067 149.333L129.333 157.333V172C129.333 180.133 128.933 186.667 128.533 186.667C128.133 186.667 120.933 180 112.667 171.867C102.533 162 96.2666 154.533 93.4667 149.333C88.1333 139.333 75.7333 95.0667 77.8666 93.6C78.6666 92.9333 82.9333 91.0667 87.3333 89.3333C97.2 85.4666 96.5333 86 96.6666 81.2C96.6666 77.8666 97.4667 76.8 101.067 75.3333C105.333 73.4666 105.333 73.4666 107.2 77.8666C109.467 83.3333 115.333 88 119.867 88C124.8 88 131.733 83.3333 132.8 79.3333C134 74.2666 132.8 68.5333 127.867 56.8C122.133 43.2 116.133 39.3333 106.933 43.3333ZM116.133 51.4666C117.2 52.6666 119.867 58.2666 122.267 63.8666C125.867 72.5333 126.267 74.4 124.8 76.6667C122.667 79.8666 118.267 80.8 116.4 78.4C115.6 77.4666 113.067 71.6 110.533 65.4666L106.133 54.2666L109.2 51.8666C112.933 48.8 113.867 48.8 116.133 51.4666ZM226.4 51.4666C228 52.5333 229.333 54.2666 229.333 55.0667C229.333 58.4 220.4 77.8666 218.267 79.2C215.333 81.0667 211.467 78.8 210.933 75.0667C210.267 70.4 219.6 49.3333 222.4 49.3333C222.933 49.3333 224.8 50.2666 226.4 51.4666ZM86.5333 76.8C87.3333 78.8 87.8666 80.4 87.7333 80.6667C87.4666 80.8 83.8666 82.2666 79.6 84C73.0667 86.5333 71.6 86.8 70.5333 85.2C68 81.2 69.3333 78.5333 75.0667 76C82.6666 72.6667 84.6666 72.8 86.5333 76.8ZM261.067 76C266.667 78.5333 268 81.2 265.467 85.2C264.4 86.8 263.067 86.5333 256.8 84C249.2 80.9333 247.6 78.2666 250.933 74.9333C253.067 72.8 254.267 72.9333 261.067 76ZM304 82C305.333 83.7333 304.933 86 301.333 95.3333C296.4 108.133 294.8 110 290 108.8C287.6 108.133 286.667 107.067 286.667 104.667C286.667 101.333 292.667 84.6667 295.067 81.6C296.8 79.3333 302 79.6 304 82ZM46.4 92.6666C51.0666 104 51.3333 107.6 47.7333 109.867C44.1333 112.133 41.6 109.733 37.4666 100C31.8666 86.9333 31.6 85.8666 34.1333 83.4666C38.5333 78.9333 41.6 81.3333 46.4 92.6666ZM256.4 92.2666C258.933 93.2 259.867 94.2666 259.467 95.8666C259.067 97.0667 256.267 107.333 253.333 118.667C245.6 147.733 243.733 151.067 224.933 170.267C216.133 179.333 208.4 186.667 207.733 186.667C207.2 186.667 206.667 180.133 206.667 172.133V157.467L217.467 149.2C223.6 144.4 229.467 138.667 231.2 135.467C232.933 132.4 237.467 120.8 241.333 109.6C247.2 92.9333 248.8 89.3333 250.533 90.1333C251.733 90.5333 254.4 91.6 256.4 92.2666ZM185.2 124.933C184.8 144.8 181.067 150.667 168.533 150.667C155.867 150.667 152.933 147.2 151.333 130.267L150.4 120H167.867H185.333L185.2 124.933ZM132.667 306.533C141.867 309.2 145.867 310.8 145.733 312.133C145.467 313.2 143.867 319.333 142.133 326L138.933 338L124.133 338.4L109.333 338.8V326.8C109.333 317.067 109.867 313.6 112.267 308.667C113.867 305.333 116.133 302.667 117.2 302.667C118.4 302.667 125.333 304.4 132.667 306.533ZM224.533 310.667C227.6 317.333 228 320.133 227.733 328.267L227.333 338H212.133H196.933L195.2 330C194.267 325.6 192.667 319.467 191.467 316.267C189.867 311.867 189.733 310.4 191.067 310C197.067 307.867 215.867 302.933 218.133 302.8C220.4 302.667 221.733 304.4 224.533 310.667Z"
                                fill="#4466E2"/>
                            <path
                                d="M736.267 74.1334C726.8 78.8 722.667 85.8667 722.667 96.9334C722.667 103.333 723.333 106 726 109.867C727.867 112.533 729.333 115.067 729.333 115.333C729.333 115.733 727.2 116.8 724.533 118C712.667 122.933 704.533 132.667 697.2 151.067C691.867 164.533 687.333 171.733 674.133 187.867C668.4 194.8 662.667 202.8 661.2 205.6C655.467 216.8 656.667 230.8 664.133 239.2C673.2 249.6 689.333 253.6 721.733 253.467C734 253.467 744 253.733 744 254C744 254.267 742.267 256.533 740.267 258.933C732.4 268.133 725.733 282.667 721.2 300.133C719.733 306.267 717.067 313.467 715.333 316.133C711.2 322.533 707.733 333.333 708.267 338.133C708.8 343.467 713.733 344.267 743.067 343.733C767.6 343.333 768.267 343.2 770.8 340.133C774.133 336.133 774 330.133 770.667 326.933C769.2 325.6 763.867 322.133 758.667 319.2C753.6 316.4 749.333 313.333 749.333 312.533C749.333 311.6 758.8 295.733 770.267 277.2C794.8 237.333 796.267 233.867 791.6 224.267C788.133 216.933 765.467 207.467 743.067 203.867C737.333 203.067 732.533 202.133 732.267 202C732 201.733 733.067 198.933 734.8 195.733C736.4 192.667 743.867 184 751.333 176.667C758.933 169.333 766.667 160.933 768.533 157.867L772.133 152.4L790.4 151.6C800.4 151.067 818.533 149.467 830.667 148C850.933 145.6 853.067 145.467 858.133 147.467C862.533 149.2 864.667 149.2 869.067 148C872.133 147.2 875.067 145.733 875.6 144.8C876.133 143.733 880.533 142 885.333 140.8C896.267 138 899.6 135.867 900.667 130.533C901.733 125.467 898.267 119.867 893.2 118.667C891.467 118.267 884.267 118.267 877.333 118.8C849.333 120.933 768.4 119.6 765.867 116.933C765.333 116.4 765.867 114.933 766.933 113.733C779.2 99.7334 772.533 76.9333 754.933 72C747.333 70 743.867 70.4 736.267 74.1334ZM759.2 82.6667C768.533 90.8 768.533 102.4 759.333 110.533C747.867 120.533 729.333 112.133 729.333 96.9334C729.333 86.1334 737.067 78.6667 748.267 78.6667C753.333 78.6667 755.467 79.4667 759.2 82.6667ZM831.333 126C890.4 126.267 892.667 126.267 892.667 128.8C892.667 131.467 885.333 134.4 878.267 134.533C876.133 134.667 873.2 136 871.467 138C868 141.733 862.8 142.267 858.267 139.467C855.733 137.867 852 138.133 830.667 140.933C801.6 144.667 761.6 145.733 752.267 142.933C741.733 139.733 738.8 134.133 744.267 127.333L747.2 123.6L758.533 124.667C764.8 125.333 797.6 125.867 831.333 126ZM778.133 222.133C785.067 226.267 787.2 229.6 786.133 234.667C785.733 236.667 780.667 246.133 774.933 255.467C769.2 264.933 759.2 281.2 752.8 291.6C745.867 302.8 740 310.933 738.4 311.333C734.933 312.533 726.667 310.933 726.667 309.067C726.667 304.667 731.6 289.733 736.667 279.067C740.4 271.067 744.533 264.8 748.533 260.667C751.867 257.333 754.667 253.733 754.667 252.667C754.667 251.6 752.8 249.867 750.667 249.067L746.667 247.333L758 232.933C764.267 225.067 770 218.667 770.8 218.667C771.6 218.667 774.8 220.267 778.133 222.133Z"
                                fill="#4466E2"/>
                            <path
                                d="M435.333 245.333C432.4 246 426.133 247.2 421.333 248C366.4 257.6 319.733 303.067 305.467 360.667C302.667 372.4 300 389.467 300.933 390.933C301.2 391.6 303.2 392 305.333 392C309.067 392 309.067 391.867 310 382.267C315.2 328 354.667 277.867 405.333 260.933C422.8 255.067 429.333 254.133 448.667 254.133C459.467 254.133 470.4 254.8 474.667 255.867C496.667 261.067 516.8 270.4 533.333 282.8C545.867 292.267 560.533 307.467 559.2 309.467C558.533 310.667 553.067 310.8 539.333 310.267L520.267 309.467L519.733 313.333C519.333 315.867 519.733 317.467 521.067 318C522 318.4 534.267 318.667 548.133 318.667C571.2 318.667 573.333 318.533 573.333 316.267C573.6 305.067 573.067 266 572.667 265.333C572.4 264.8 570.4 264.667 568.4 264.933L564.667 265.6L565.2 282.133C565.333 291.2 565.067 298.667 564.533 298.667C563.867 298.667 559.467 294.8 554.667 290.133C533.6 269.333 504.133 253.467 477.333 248.267C454.667 243.867 445.867 243.333 435.333 245.333Z"
                                fill="#4466E2"/>
                            <path
                                d="M590.133 402.933C581.333 488 500.533 548.4 421.333 529.067C392.933 522.133 369.333 508.4 347.2 485.467C339.733 477.867 338.8 476 341.733 475.867C345.6 475.733 376.533 476.133 377.867 476.4C378.667 476.533 379.467 474.8 379.733 472.533L380.133 468.4L354.4 467.6C331.067 466.8 328.533 466.933 326.933 468.933C326 470.267 325.6 472.133 326 473.067C326.4 474.133 326.667 485.333 326.667 498.133V521.333H331.067H335.467L334.933 504.667C334.533 492.533 334.8 488 335.867 488C336.8 488 341.733 492.133 346.933 497.333C366.267 516.4 389.067 529.067 417.333 536.667C424.533 538.533 443.733 541.2 450.8 541.333C471.2 541.467 499.867 534.267 518.133 524.533C561.733 501.2 592.4 455.867 598 406.667C598.533 402.667 599.2 398.267 599.467 396.933C600 395.067 599.333 394.667 595.6 394.667H590.933L590.133 402.933Z"
                                fill="#4466E2"/>
                            <path
                                d="M565.333 610.133C562.8 611.2 558.267 614.533 555.2 617.467L549.733 622.8L543.467 621.2C528.8 617.467 513.867 622.267 493.333 637.2C487.067 641.733 475.333 648.8 467.067 652.8C452.533 659.867 452 660.133 446.4 658.533C428.933 653.867 405.6 664.8 377.867 691.067C367.867 700.4 361.867 704.667 353.333 709.067C347.067 712.133 337.2 718.667 331.467 723.467C323.733 730 318 733.467 310.133 736.533C297.867 741.333 296.933 742.533 294.8 756C293.733 762.4 293.867 768.667 295.067 779.6C296 787.867 297.2 794.933 297.733 795.467C298.133 795.867 301.2 796.667 304.533 796.933C313.467 798 316.533 795.467 320.133 784C321.867 778.933 323.6 774.667 324 774.667C324.533 774.667 325.6 777.867 326.533 781.733C327.333 785.6 329.333 790.667 330.8 793.2C333.467 797.6 333.733 797.6 340.8 797.067C344.933 796.667 348.667 795.733 349.333 794.8C349.867 793.867 350.667 787.6 351.2 780.933C351.733 774.133 352.533 768.267 353.067 767.867C353.6 767.333 360.267 764.667 368 762C429.2 740.267 472.8 718.133 482 704.133C484.4 700.4 492.133 697.067 494.133 698.933C495.2 700.133 491.867 720.667 485.867 748.267C479.467 778.133 478.4 791.733 482.133 794.8C484.533 796.667 514.667 798.267 520.667 796.8C526.933 795.2 523.6 785.467 514.4 779.067C509.6 775.867 509.333 775.333 510.133 770.133C511.467 761.867 515.467 742.933 517.867 734.667C519.067 730.667 520 726.133 520 724.667C520 720.4 538.533 684.8 541.467 683.467C542.8 682.8 544.267 682.533 544.533 682.8C544.8 683.067 546.133 697.733 547.333 715.333C548.533 732.933 550.267 757.333 551.2 769.6C552.133 784 553.333 792.533 554.4 793.6C555.6 794.8 561.867 795.333 577.067 795.333C597.2 795.333 598 795.2 598.4 792.533C598.8 789.867 592.4 782.267 583.2 774.4L578.933 770.933L577.867 721.733C577.2 694.8 576.667 671.2 576.667 669.333C576.667 666.533 577.6 665.733 583.333 664C592.533 661.333 600.533 653.067 603.333 643.733C605.2 637.2 605.2 635.867 603.2 629.333C598.4 612.933 580.133 603.733 565.333 610.133ZM586.667 619.867C599.067 628.8 598.933 644.4 586.533 653.6C578.133 659.867 564.533 656.933 558.8 647.6C555.067 641.6 555.067 631.6 558.667 625.6C564.133 616.667 578.267 613.733 586.667 619.867ZM532.667 647.333C537.333 651.867 537.067 660.933 532 676.133C528.133 687.6 519.333 706.667 514.667 713.333C513.467 715.2 512 720.267 511.6 724.667C511.067 729.067 509.733 735.2 508.667 738.267C506.8 743.733 503.867 758.533 502 772.8C501.067 779.733 501.067 779.733 506.533 783.467C509.467 785.6 512 787.733 512 788.267C512 789.6 498 789.6 492 788.533L487.733 787.6L488.4 778.8C488.667 774 491.467 758.933 494.4 745.333C497.333 731.733 500.8 713.6 501.867 705.067C506.8 669.333 517.067 644 526.667 644C528.267 644 530.933 645.467 532.667 647.333ZM444.8 667.6C448.667 679.6 455.333 687.2 468.667 694.8L476.133 699.067L473.067 702.267C461.2 715.067 419.333 735.467 366.533 754.133C353.467 758.8 352.8 758.933 351.067 756.533C348.8 753.467 348.8 753.6 365.733 742C378.133 733.6 379.6 733.067 392.4 730.667C408.267 727.6 427.733 718.667 440.4 708.667C449.6 701.333 452.133 696.933 448.933 693.733C447.067 691.733 446.133 692.267 438.533 699.067C426.267 710.267 407.467 719.467 390.4 722.667C380.933 724.533 375.067 726.4 371.067 728.933C368 731.067 358.667 737.067 350.4 742.4L335.333 752.133L332.4 748.533C327.867 742.8 327.6 738.533 331.733 734.133C337.467 728.133 350.933 718.933 361.6 714C368.8 710.667 373.6 707.2 380 700.533C401.867 678.133 422.533 665.733 438.4 665.467C442.667 665.333 444.267 665.867 444.8 667.6ZM570.267 723.867L571.6 776.4L575.467 779.2C577.6 780.8 580.8 783.333 582.667 785.067L586 788.133L573.733 787.733C567.067 787.467 561.333 787.067 560.933 786.667C560.667 786.267 558.8 761.733 556.8 732.133C553.733 687.733 553.467 678 554.933 677.2C564.267 671.467 567.467 669.867 568.133 670.533C568.667 670.933 569.6 694.933 570.267 723.867Z"
                                fill="#4466E2"/>
                        </svg>
                    }
                </div>
            </motion.div>
            <div className='fixed w-full px-8 bottom-8'>
                <motion.div
                    className='w-full flex items-center justify-center gap-2'
                    initial={{transform: 'translateY(200px)'}}
                    animate={{transform: 'translateY(0px)'}}
                    exit={{transform: 'translateY(200px)', transition: {delay: 0.1}}}
                    transition={{delay: 0.2}}
                >
                    <Button className='py-6' onClick={handlePrev}>
                        <IoArrowBack className='text-white'/>
                    </Button>
                    <Button className='w-full sm:w-[400px] py-6' onClick={handleNext}>
                        ДАЛЕЕ
                    </Button>
                </motion.div>
            </div>
        </div>
    )
}